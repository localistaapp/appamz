name: Daily Trigger

on:
  schedule:
    - cron: "0 15 * * *"  # Daily 7:30 AM IST

jobs:
  daily:
    if: github.event.schedule == '0 15 * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Trigger daily task
        run: |
          for i in 1 2 3; do
            echo "Attempt $i..."
            if curl -s -o /dev/null -w "%{http_code}" -X POST https://amuzely.onrender.com/run-task-daily?key=${{ secrets.TASK_KEY }} | grep -q "200"; then
              echo "Success"
              exit 0
            fi
            echo "Failed, retrying in 30s..."
            sleep 30
          done
          echo "All retries failed"
          exit 1
