"use strict";(self.webpackChunkssr_client=self.webpackChunkssr_client||[]).push([[33],{33:(e,t,r)=>{r.r(t),r.d(t,{default:()=>j});var s=r(643),o=r(214),n=r.n(o),a={message:"Missing file parameter for upload"},i={message:"Missing fileName parameter for upload"},l={message:"Missing public key for upload"},c={message:"Request to ImageKit upload endpoint failed due to network error"},u={message:"Missing signature for upload. The SDK expects token, signature and expire for authentication."},d={message:"Missing token for upload. The SDK expects token, signature and expire for authentication."},p={message:"Missing expire for upload. The SDK expects token, signature and expire for authentication."},g={message:"Invalid transformation parameter. Please include at least pre, post, or both."},f={message:"Invalid pre transformation parameter."},m={message:"Invalid post transformation parameter."};class h extends Error{constructor(e,t){super(e),this.$ResponseMetadata=void 0,this.name="ImageKitInvalidRequestError",this.$ResponseMetadata=t}}class y extends Error{constructor(e,t){super(e),this.reason=void 0,this.name="ImageKitAbortError",this.reason=t}}class b extends Error{constructor(e){super(e),this.name="ImageKitUploadNetworkError"}}class x extends Error{constructor(e,t){super(e),this.$ResponseMetadata=void 0,this.name="ImageKitServerError",this.$ResponseMetadata=t}}const v=(e,t)=>{let r={...e};const s=w(t);return Object.defineProperty(r,"$ResponseMetadata",{value:s,enumerable:!1,writable:!1}),r},w=e=>{const t=function(e){const t={},r=e.getAllResponseHeaders();Object.keys(r).length&&r.trim().split(/[\r\n]+/).map((e=>e.split(/: /))).forEach((e=>{t[e[0].trim().toLowerCase()]=e[1].trim()}));return t}(e);return{statusCode:e.status,headers:t,requestId:t["x-request-id"]}};"function"===typeof SuppressedError&&SuppressedError;(0,s.createContext)({});var S=r(507);const j=e=>{let{url:t}=e;const[r,o]=(0,s.useState)(""),[j,k]=(0,s.useState)(0),[E,M]=(0,s.useState)(0),P=(0,s.createRef)(),q=new AbortController;return(0,S.jsxs)("div",{className:"main",children:[(0,S.jsxs)("div",{class:"container",children:[(0,S.jsx)("h1",{children:"Add Product"}),(0,S.jsx)("input",{id:"pTitle",type:"text",placeholder:"Title"}),(0,S.jsx)("input",{id:"pHighlights",type:"text",placeholder:"Highlights (e.g. type: kidswear, age: 9-10)"}),(0,S.jsx)("textarea",{id:"pDesc",placeholder:"Description"}),(0,S.jsx)("input",{id:"pPrice",type:"number",placeholder:"Price"}),(0,S.jsxs)("select",{id:"pEligibleFor",children:[(0,S.jsx)("option",{disabled:!0,selected:!0,children:"Eligible for"}),(0,S.jsx)("option",{children:"Online Purchase"}),(0,S.jsx)("option",{children:"Online Enquiry"}),(0,S.jsx)("option",{children:"Online Booking"})]}),(0,S.jsxs)("select",{id:"pCategory",children:[(0,S.jsx)("option",{selected:!0,children:"Default"}),(0,S.jsx)("option",{children:"Season's Special"}),(0,S.jsx)("option",{children:"New Arrival"})]}),(0,S.jsx)("input",{type:"file",ref:P,style:{width:"92%"}}),(0,S.jsx)("div",{className:"footer-buttons",children:(0,S.jsx)("button",{style:{background:"linear-gradient(180deg, #595959, #000000)"},type:"button",onClick:async()=>{const e=P.current;if(!e||!e.files||0===e.files.length)return void alert("Please select a file to upload");const t=e.files[0];let r;try{r=await(async()=>{try{const e=await fetch("/auth");if(!e.ok){const t=await e.text();throw new Error("Request failed with status ".concat(e.status,": ").concat(t))}const t=await e.json(),{signature:r,expire:s,token:o,publicKey:n}=t;return{signature:r,expire:s,token:o,publicKey:n}}catch(e){throw console.error("Authentication error:",e),new Error("Authentication request failed")}})()}catch(E){return void console.error("Failed to authenticate for upload:",E)}const{signature:s,expire:o,token:n,publicKey:S}=r;try{const e=await(j={expire:o,token:n,signature:s,publicKey:S,file:t,fileName:t.name,onProgress:e=>{k(e.loaded/e.total*100)},abortSignal:q.signal},j?new Promise(((e,t)=>{const{xhr:r}=j||{};delete j.xhr;const s=r||new XMLHttpRequest;if(!j.file)return t(new h(a.message));if(!j.fileName)return t(new h(i.message));if(!j.publicKey||0===j.publicKey.length)return t(new h(l.message));if(!j.token)return t(new h(d.message));if(!j.signature)return t(new h(u.message));if(!j.expire)return t(new h(p.message));if(j.transformation){if(!Object.keys(j.transformation).includes("pre")&&!Object.keys(j.transformation).includes("post"))return t(new h(g.message));if(Object.keys(j.transformation).includes("pre")&&!j.transformation.pre)return t(new h(f.message));if(Object.keys(j.transformation).includes("post")){if(!Array.isArray(j.transformation.post))return t(new h(m.message));for(let e of j.transformation.post){if("abs"===e.type&&!e.protocol&&!e.value)return t(new h(m.message));if("transformation"===e.type&&!e.value)return t(new h(m.message))}}}var o=new FormData;let n;for(n in j)if(n)if("file"===n&&"string"!=typeof j.file)o.set("file",j.file,String(j.fileName));else if("tags"===n&&Array.isArray(j.tags))o.set("tags",j.tags.join(","));else if("signature"===n)o.set("signature",j.signature);else if("expire"===n)o.set("expire",String(j.expire));else if("token"===n)o.set("token",j.token);else if("responseFields"===n&&Array.isArray(j.responseFields))o.set("responseFields",j.responseFields.join(","));else if("extensions"===n&&Array.isArray(j.extensions))o.set("extensions",JSON.stringify(j.extensions));else if("customMetadata"!==n||"object"!==typeof j.customMetadata||Array.isArray(j.customMetadata)||null===j.customMetadata){if("transformation"===n&&"object"===typeof j.transformation&&null!==j.transformation)o.set(n,JSON.stringify(j.transformation));else if("checks"===n&&j.checks)o.set("checks",j.checks);else if(void 0!==j[n]){if(["onProgress","abortSignal"].includes(n))continue;o.set(n,String(j[n]))}}else o.set("customMetadata",JSON.stringify(j.customMetadata));function S(){var e;return s.abort(),t(new y("Upload aborted",null===(e=j.abortSignal)||void 0===e?void 0:e.reason))}if(j.onProgress&&(s.upload.onprogress=function(e){j.onProgress&&j.onProgress(e)}),j.abortSignal){var k;if(j.abortSignal.aborted)return t(new y("Upload aborted",null===(k=j.abortSignal)||void 0===k?void 0:k.reason));j.abortSignal.addEventListener("abort",S),s.addEventListener("loadend",(()=>{j.abortSignal&&j.abortSignal.removeEventListener("abort",S)}))}s.open("POST","https://upload.imagekit.io/api/v1/files/upload"),s.onerror=function(e){return t(new b(c.message))},s.onload=function(){if(s.status>=200&&s.status<300)try{var r=JSON.parse(s.responseText),o=v(r,s);return e(o)}catch(i){return t(i)}else if(s.status>=400&&s.status<500)try{var n;return r=JSON.parse(s.responseText),t(new h(null!==(n=r.message)&&void 0!==n?n:"Invalid request. Please check the parameters.",w(s)))}catch(i){return t(i)}else try{var a;return r=JSON.parse(s.responseText),t(new x(null!==(a=r.message)&&void 0!==a?a:"Server error occurred while uploading the file. This is rare and usually temporary.",w(s)))}catch(i){return t(new x("Server error occurred while uploading the file. This is rare and usually temporary.",w(s)))}},s.send(o)})):Promise.reject(new h("Invalid options provided for upload")));M(e.url),console.log("Upload response:",e)}catch(A){A instanceof y?console.error("Upload aborted:",A.reason):A instanceof h?console.error("Invalid request:",A.message):A instanceof b?console.error("Network error:",A.message):A instanceof x?console.error("Server error:",A.message):console.error("Upload error:",A)}var j},children:"Upload file"})}),(0,S.jsx)("br",{}),"Upload progress: ",(0,S.jsx)("progress",{value:j,max:100})]}),(0,S.jsxs)("div",{class:"footer-buttons",children:[(0,S.jsxs)("button",{onClick:()=>{(()=>{const e=document.querySelector("#pTitle").value,t=document.querySelector("#pHighlights").value,r=document.querySelector("#pDesc").value,s=document.querySelector("#pPrice").value,o=document.querySelector("#pEligibleFor").options[document.querySelector("#pEligibleFor").selectedIndex].value,a=document.querySelector("#pCategory").options[document.querySelector("#pCategory").selectedIndex].value,i="https://ik.imagekit.io/amuzely/tr:n-ik_ml_thumbnail/06c4ecec55b4cb2db03da5b984bbeb4b_EWQ2YMVEU.avif",l=JSON.parse(window.sessionStorage.getItem("user-profile")).storeId;console.log("--title--",e),console.log("--highlights--",t),console.log("--description--",r),console.log("--price--",s),console.log("--eligibleFor--",o),console.log("--primaryCat--",a),console.log("--thumbnailUrl--",i),n().post("/createProduct",{title:e,highlights:t,description:r,price:s,eligibleFor:o,primaryCat:a,thumbnailUrl:i,storeId:l}).then((e=>{console.log("--Create Product Response--",e),setTimeout((()=>{window.location.reload()}),500)}))})()},children:[(0,S.jsx)("span",{children:"Save & Add"}),(0,S.jsx)("i",{class:"fas fa-plus"})]}),(0,S.jsxs)("button",{children:[(0,S.jsx)("span",{children:"Finish"}),(0,S.jsx)("i",{class:"fas fa-arrow-right"})]})]})]})}}}]);
//# sourceMappingURL=33.ba9d0488.chunk.js.map